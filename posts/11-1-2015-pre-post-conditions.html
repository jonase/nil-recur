<html>
  <head>
    <meta charset="utf-8"/>
    <title>nil/recur</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css">
    <link href="../css/screen.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <h1><a class="navbar-brand" href="/nil-recur/index.html">nil/recur</a></h1>
        </div>
        <!-- nav links -->
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li ><a href="/nil-recur/index.html">Home</a></li>
            <li ><a href="/nil-recur/archives.html">Archives</a></li>
            
            <li >
              <a href="/nil-recur/pages/about.html">About</a>
            </li>
            
            <li><a href="/nil-recur/feed.xml">RSS</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div id="wrapper" class="container">
      <div class="row">
        <div class="col-md-8">
          <div id="content">
            
<div id="post">
    <div id="post-header">
        <h2>A note on pre and post conditions</h2>
        <p class="date">January 11, 2015</p>
    </div>
    <div>
        
        <p>David Nolen recently published two interesting blog posts (<a href='http://swannodette.github.io/2015/01/10/faster-validation-through-immutability/'>here</a> and  <a href='http://swannodette.github.io/2015/01/09/life-with-dynamic-typing/'>here</a>) about the usefulness of pre and post conditions. I have recently started to use quite a lot of pre/post conditions (and other assertions and invariants) in my own code and found that they really help a lot during development. This is just a short note about how one of the examples David gave can be extended to check more known properties of the function under test.</p><p>Let's use the following distance function as the running example:</p><pre><code>&#40;defn dist &#91;p0 p1&#93;
  &#40;let &#91;a &#40;- &#40;:x p0&#41; &#40;:x p1&#41;&#41;
        b &#40;- &#40;:y p0&#41; &#40;:y p1&#41;&#41;&#93;
    &#40;js/Math.sqrt &#40;+ &#40;&#42; a a&#41;
                     &#40;&#42; b b&#41;&#41;&#41;&#41;&#41;
</code></pre><p>David showed how to add <strong>pre conditions</strong> to this function in order to do runtime type checking:</p><pre><code>&#40;defn dist &#91;p0 p1&#93;
  {:pre &#91;&#40;point? p0&#41; &#40;point? p1&#41;&#93;}
  ...&#41;
</code></pre><p>This is really useful and will catch a lot bugs during development but pre and post conditions are not limited to only type checking. This example is especially illuminating since distance functions are <a href='http://en.wikipedia.org/wiki/Metric&#95;%28mathematics%29'>well studied in mathematics</a>:</p><ul><li><code>&#40;dist p0 p1&#41;</code> = <code>0</code> if and only if <code>&#40;= p0 p1&#41;</code></li><li><code>&#40;dist p0 p1&#41;</code> > <code>0</code> if and only if <code>&#40;not= p0 p1&#41;</code></li><li><code>&#40;dist p0 p1&#41;</code> = <code>&#40;dist p1 p0&#41;</code> for all points <code>p0</code> and <code>p1</code></li><li><code>&#40;dist p0 p1&#41;</code> + <code>&#40;dist p1 p2&#41;</code> >= <code>&#40;dist p0 p2&#41;</code> for all points <code>p0</code>, <code>p1</code> and <code>p2</code>.</li></ul><p>It should be quite obvious that checking the types of the input arguments has nothing to do with whether the above properties hold or not. The first two properties however lend themselves well as a post conditions:</p><pre><code>&#40;defn dist &#91;p0 p1&#93;
  {:pre &#91;&#40;point? p0&#41; &#40;point? p1&#41;&#93;
   :post &#91;&#40;if &#40;= p0 p1&#41;
            &#40;zero? %&#41;
            &#40;pos? %&#41;&#41;&#93;}
  ...&#41;
</code></pre><p>Note that <code>%</code> is bound to the functions return value. The expression <code>&#40;if &#40;= p0 p1&#41; &#40;zero? %&#41; &#40;pos? %&#41;&#41;</code> completely captures the first two properties of our metric function and nicely ties the input arguments to the output without having to do the actual calculation (which could introduce its own set of bugs).</p><p>The last two properties doesn't lend themselves well to pre / post conditions and are therefor better handled by external testing tools. One obvious choice in this particular case is to use <a href='https://github.com/clojure/test.check'>test.check</a>:</p><pre><code>&#40;def commutativity
  &#40;prop/for-all &#91;p0 &#40;gen-point&#41;
                 p1 &#40;gen-point&#41;&#93;
    &#40;almost= &#40;dist p0 p1&#41; &#40;dist p1 p0&#41;&#41;&#41;&#41;

&#40;def triangle-inequality
  &#40;prop/for-all &#91;p0 &#40;gen-point&#41;
                 p1 &#40;gen-point&#41;
                 p2 &#40;gen-point&#41;&#93;
    &#40;&gt;= &#40;+ &#40;dist p0 p1&#41; &#40;dist p1 p2&#41;&#41;
        &#40;dist p0 p3&#41;&#41;&#41;&#41;
</code></pre><p>All tools that help us create reliable software should be carefully evaluated and used when appropriate. I'm happy to have put pre/post in my own toolbelt.</p>
    </div>
    
    <div id="tags">
        <b>Tags: </b>
        
        <a href="/nil-recur/tags/test.check.html">test.check</a>
        
        <a href="/nil-recur/tags/Design by Contract.html">Design by Contract</a>
        
        <a href="/nil-recur/tags/Pre &amp; post conditions.html">Pre &amp; post conditions</a>
        
        <a href="/nil-recur/tags/Clojure.html">Clojure</a>
        
    </div>
    

    <div id="prev-next">
        
        
        
        <a href="/nil-recur/posts/14-12-2014-controlled-input.html">Controlled and Uncontrolled input &raquo;</a>
        
    </div>

    


</div>

          </div>
        </div>

        <div class="col-md-3">
          <div id="sidebar">
            <h3>Links</h3>
            <ul id="links">
              <li><a href="https://github.com/jonase">My Github</a></li>
              <li><a href="https://twitter.com/jonasenlund">Twitter</a></li>
              
            </ul>
            <div id="recent">
              <h3>Recent Posts</h3>
              <ul>
                
                <li><a href="/nil-recur/posts/11-1-2015-pre-post-conditions.html">A note on pre and post conditions</a></li>
                
                <li><a href="/nil-recur/posts/14-12-2014-controlled-input.html">Controlled and Uncontrolled input</a></li>
                
                <li><a href="/nil-recur/posts/7-12-2014-om-table.html">Reusable Om components, part 2</a></li>
                
              </ul>
            </div>
            <div id="tags">
              <h3>Tags</h3>
              <ul>
                
                <li><a href="/nil-recur/tags/Clojurescript.html">Clojurescript</a></li>
                
                <li><a href="/nil-recur/tags/React.html">React</a></li>
                
                <li><a href="/nil-recur/tags/Om.html">Om</a></li>
                
                <li><a href="/nil-recur/tags/requestAnimationFrame.html">requestAnimationFrame</a></li>
                
                <li><a href="/nil-recur/tags/Reagent.html">Reagent</a></li>
                
                <li><a href="/nil-recur/tags/Clojure.html">Clojure</a></li>
                
                <li><a href="/nil-recur/tags/Pre &amp; post conditions.html">Pre &amp; post conditions</a></li>
                
                <li><a href="/nil-recur/tags/Design by Contract.html">Design by Contract</a></li>
                
                <li><a href="/nil-recur/tags/test.check.html">test.check</a></li>
                
              </ul>
            </div>
          </div>
        </div>
      </div>
      <footer>Copyright &copy; 2014 Jonas Enlund
        <p style="text-align: center;">
          Powered by <a href="https://github.com/lacarmen/cryogen">Cryogen</a>
        </p>
      </footer>
    </div>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="../js/highlight.pack.js" type="text/javascript"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57222408-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
